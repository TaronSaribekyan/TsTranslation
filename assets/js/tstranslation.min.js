/** 
 * @author Taron Saribekyan <saribekyantaron@gmail.com>
 * @copyright Copyright &copy; 2014, Taron Saribekyan. All rights reserved.
 * @license http://opensource.org/licenses/BSD-3-Clause The BSD 3-Clause License
 * @version 1.0.0
 */
function multiTranslate(t,a,e){var n=0,s=0,r=t.length,o=$(".tstranslation-list .ts-translate.active").attr("data-language"),i=e.find(".progress-bar");$.each(t,function(){var t=$(this),l=t.text();$.ajax({type:"POST",url:a,data:{value:l,language:o},success:function(a){var o=JSON.parse(a);1==o.ok?(s++,n=s/r*100,n+="%",i.css({width:n}),"Empty"!=l?(t.text(o.message),l!=o.message&&($(t).editable("setValue",o.message),t.addClass("editable-unsaved"))):$(t).editable("setValue","")):alert(o.message),s==r&&setTimeout(function(){e.slideUp("slow"),i.css({width:"0%"})},2e3)}},!1)})}function multiSave(t,a,e){var n=0,s=0,r=t.length,o=$(".tstranslation-list .ts-translate.active").attr("data-language"),i=e.find(".progress-bar");$.each(t,function(){var t=$(this),l=t.text(),d=t.attr("data-pk");$.ajax({type:"POST",url:a,data:{pk:d,value:l,name:o},success:function(a){var o=JSON.parse(a);1==o.ok?(s++,t.removeClass("editable-unsaved"),n=s/r*100,n+="%",i.css({width:n})):alert(o.message),s==r&&setTimeout(function(){e.slideUp("slow"),i.css({width:"0%"})},2e3)}},!1)})}function tstranslationStartLoader(t){t.html('<img src="'+$("#tstranslationAssetsUrl").val()+'/images/ajax-loader2.gif">'),$("body").css({cursor:"wait"})}function tstranslationEndLoader(t){t.html("&nbsp;&nbsp;"),$("body").css({cursor:"auto"})}$(document).ready(function(){thisUrl=$("#tstranslationControllerUrl").val()+"/",$(".tstranslation-list table tbody").sortable(),$(".tstranslation-list table tbody").disableSelection(),orderCount=0,$(document).on("sortupdate",".tstranslation-list table tbody",function(){0==orderCount&&($(".ts-add-language").parents("span").prepend('<button type="button" class="btn btn-info ts-save-ordering" data-tstoggle="tooltip" title="save current ordering for frontend language widget"><i class="glyphicon glyphicon-list">&nbsp;&nbsp;</i>Save ordering</button>'),orderCount++)}),$(document).on("click",".ts-save-ordering",function(){var t=new Array,a=thisUrl+"saveOrdering";$.each($(".tstranslation-list table tbody tr"),function(a){t[a]=$(this).find(".ts-remove").attr("data-id")}),$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader($(".ts-save-ordering i")),data:{languageList:t},success:function(t){data=JSON.parse(t),1==data.ok?($(".ts-save-ordering").tooltip("hide"),$(".ts-save-ordering").remove(),orderCount=0):alert(data.message),tstranslationEndLoader($(".ts-save-ordering i"))}},!1)}),$(document).on("click",".ts-remove",function(){var t=prompt("Delete translated messages also (no/yes)?","no");if("no"==t||"yes"==t){var a=$(this).attr("data-id"),e=thisUrl+"removeLanguage",n=$(this);$.ajax({type:"POST",url:e,beforeSend:tstranslationStartLoader(n.parents("tr").find(".for-loader")),data:{id:a,deleteTranslations:t},success:function(t){data=JSON.parse(t),1==data.ok?n.parents("tr").remove():alert(data.message),tstranslationEndLoader(n.parents("tr").find(".for-loader"))}},!1)}}),$(document).on("click",".ts-change-status",function(){var t=$(this).attr("data-id"),a=thisUrl+"changeStatus",e=$(this);$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader(e.parents("tr").find(".for-loader")),data:"id="+t,success:function(t){if(data=JSON.parse(t),1==data.ok){var a=e.parents("tr").find(".ts-status");1==data.status?(a.removeClass("alert-danger").removeClass("badge-important").addClass("alert-success").addClass("badge-success"),a.html("Active")):(a.removeClass("alert-success").removeClass("badge-success").addClass("alert-danger").addClass("badge-important"),a.html("Not active"))}else alert(data.message);tstranslationEndLoader(e.parents("tr").find(".for-loader"))}},!1)}),$(document).on("click",".ts-make-default",function(){if(confirm("Change default language?")){var t=$(this).attr("data-id"),a=thisUrl+"makeDefault",e=$(this);$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader(e.parents("tr").find(".for-loader")),data:"id="+t,success:function(t){data=JSON.parse(t),1==data.ok?(defaultSpan=e.parents("table").find(".ts-default").clone(),e.parents("table").find(".ts-default").remove(),e.parents("tr").find(".ts-status").after(defaultSpan)):alert(data.message),tstranslationEndLoader(e.parents("tr").find(".for-loader"))}},!1)}}),$(document).on("change",".ts-add-language",function(){if(""!=$(this).val()&&confirm("Add new language?")){$(this).parent("span").removeClass("open");var t=$(this).val(),a=thisUrl+"addLanguage";$.ajax({type:"POST",url:a,beforeSend:tstranslationStartLoader($(".ts-add-language").prev("button").find("i")),data:"id="+t,success:function(t){data=JSON.parse(t),1==data.ok?window.location=data.redirectUrl:alert(data.message),tstranslationEndLoader($(".ts-add-language").prev("button").find("i"))}},!1)}}),$(document).on("click",".ts-translate",function(){if(!$(this).hasClass("active")){var t=$(".ts-translate");$.each(t,function(){$(this).removeClass("active"),$(this).find("i").removeClass("glyphicon-check")}),$(this).addClass("active"),$(this).find("i").addClass("glyphicon-check"),$(".tstranslation-category-tabs").css({display:"block"});var a=$(this),e=a.attr("data-language"),n=$(".tstranslation-category-tabs li.active").find("a");if("undefined"!=typeof n.attr("href")){var s=n.attr("href").split("#").pop(),r=$("#"+s).attr("data-language");if("undefined"==typeof r||r!=e){$("#"+s+'[data-language="'+r+'"]').remove();var o=thisUrl+"getTranslationsByCategory",i=n.attr("data-category");$.ajax({type:"POST",url:o,beforeSend:function(){tstranslationStartLoader(n.parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader")),n.parents(".tstranslation-category-tabs").next("div.tab-content").find(".tab-pane").each(function(){$(this).removeClass("active")})},data:{language:e,category:i,listId:s},success:function(t){n.parents(".tstranslation-category-tabs").next("div.tab-content").append(t),tstranslationEndLoader(n.parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"))}},!1)}}}}),$(document).on("show.bs.tab",".tstranslation-category-tabs li",function(t){var a=t.target,e=a.href.split("#"),n=e.pop(),s=$("#"+n).attr("data-language"),r=$(".ts-translate.active").attr("data-language");if("undefined"==typeof r)alert("Select language!");else if("undefined"==typeof s||s!=r){$("#"+n+'[data-language="'+s+'"]').remove();var o=thisUrl+"getTranslationsByCategory",i=$(a).attr("data-category");$.ajax({type:"POST",url:o,beforeSend:function(){tstranslationStartLoader($(a).parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader")),$(a).parents(".tstranslation-category-tabs").next("div.tab-content").find(".tab-pane").each(function(){$(this).removeClass("active")})},data:{language:r,category:i,listId:n},success:function(t){$(a).parents(".tstranslation-category-tabs").next("div.tab-content").append(t),tstranslationEndLoader($(a).parents(".tstranslation-category-tabs").next("div.tab-content").find(".for-loader"))}},!1)}return!0}),$(document).on("click",".editable-google-translate",function(){var t=thisUrl+"googleTranslate",a=$(this).parents(".control-group").find(".editable-input").find("textarea"),e=a.val(),n=$(".tstranslation-list .ts-translate.active").attr("data-language");$.ajax({type:"POST",url:t,beforeSend:tstranslationStartLoader(a.parents(".control-group").find(".for-loader")),data:{value:e,language:n},success:function(t){var e=JSON.parse(t);1==e.ok?a.val(e.message):alert(e.message),tstranslationEndLoader(a.parents(".control-group").find(".for-loader"))}},!1)}),$(document).on("click",".google-translate-all",function(){var t=thisUrl+"googleTranslate",a=$(this).parents("table").find(".translate-div").find('.translate-value:not(".editable-unsaved")');if(0!=a.length){var e=$(this).parents(".tab-pane.active").find(".progress");e.attr("style","display:block"),multiTranslate(a,t,e)}}),$(document).on("click",".save-all",function(){var t=thisUrl+"saveTranslate",a=$(this).parents("table").find(".translate-div").find(".translate-value.editable-unsaved");if(0!=a.length){var e=$(this).parents(".tab-pane.active").find(".progress");e.attr("style","display:block"),multiSave(a,t,e)}}),$(document).on("click",".ts-add-language",function(t){t.stopPropagation()}),$(document).on("click","#tsLangChangerForm a",function(t){t.prventDefault;var a=$(this),e=a.attr("data-language");return $("input#tsNewLang").val(e),$("#tsLangChangerForm").submit(),!1})});